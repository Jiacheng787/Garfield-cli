"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5371],{4852:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var i=t(9231);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},s=Object.keys(e);for(i=0;i<s.length;i++)t=s[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)t=s[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=i.createContext({}),p=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=p(e.components);return i.createElement(l.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},m=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(t),m=a,k=u["".concat(l,".").concat(m)]||u[m]||d[m]||s;return t?i.createElement(k,r(r({ref:n},c),{},{components:t})):i.createElement(k,r({ref:n},c))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,r=new Array(s);r[0]=m;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[u]="string"==typeof e?e:a,r[1]=o;for(var p=2;p<s;p++)r[p]=t[p];return i.createElement.apply(null,r)}return i.createElement.apply(null,t)}m.displayName="MDXCreateElement"},7181:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var i=t(5907),a=(t(9231),t(4852));const s={sidebar_position:2},r="Webpack 5 \u5347\u7ea7\u65b9\u6848",o={unversionedId:"Webpack5\u5347\u7ea7\u65b9\u6848",id:"Webpack5\u5347\u7ea7\u65b9\u6848",title:"Webpack 5 \u5347\u7ea7\u65b9\u6848",description:"\u524d\u8a00",source:"@site/docs/Webpack5\u5347\u7ea7\u65b9\u6848.md",sourceDirName:".",slug:"/Webpack5\u5347\u7ea7\u65b9\u6848",permalink:"/Garfield-cli/docs/Webpack5\u5347\u7ea7\u65b9\u6848",draft:!1,editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/Webpack5\u5347\u7ea7\u65b9\u6848.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/Garfield-cli/docs/intro"},next:{title:"\u524d\u8a00",permalink:"/Garfield-cli/docs/Webpack\u4f18\u5316\u65b9\u6848/\u524d\u8a00"}},l={},p=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u63d2\u4ef6\u5347\u7ea7\u65b9\u6848",id:"\u63d2\u4ef6\u5347\u7ea7\u65b9\u6848",level:2},{value:"\u914d\u7f6e\u4f18\u5316\u65b9\u6848",id:"\u914d\u7f6e\u4f18\u5316\u65b9\u6848",level:2},{value:"\u57fa\u4e8e React + TypeScript \u7684 Webpack5 \u914d\u7f6e\u6700\u4f73\u5b9e\u8df5",id:"\u57fa\u4e8e-react--typescript-\u7684-webpack5-\u914d\u7f6e\u6700\u4f73\u5b9e\u8df5",level:2},{value:"<code>package.json</code> \u914d\u7f6e",id:"packagejson-\u914d\u7f6e",level:3},{value:"Webpack \u76f8\u5173",id:"webpack-\u76f8\u5173",level:4},{value:"Babel \u76f8\u5173",id:"babel-\u76f8\u5173",level:4},{value:"React \u76f8\u5173",id:"react-\u76f8\u5173",level:4},{value:"TypeScript \u7c7b\u578b\u5b9a\u4e49\u5e93",id:"typescript-\u7c7b\u578b\u5b9a\u4e49\u5e93",level:4},{value:"\u7b2c\u4e09\u65b9 helpers",id:"\u7b2c\u4e09\u65b9-helpers",level:4},{value:"<code>webpack.config.js</code> \u914d\u7f6e",id:"webpackconfigjs-\u914d\u7f6e",level:3},{value:"\u5982\u4f55\u57fa\u4e8e chain-webpack \u548c TypeScript \u7f16\u5199 Webpack \u914d\u7f6e",id:"\u5982\u4f55\u57fa\u4e8e-chain-webpack-\u548c-typescript-\u7f16\u5199-webpack-\u914d\u7f6e",level:2}],c={toc:p},u="wrapper";function d(e){let{components:n,...t}=e;return(0,a.kt)(u,(0,i.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"webpack-5-\u5347\u7ea7\u65b9\u6848"},"Webpack 5 \u5347\u7ea7\u65b9\u6848"),(0,a.kt)("h2",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,a.kt)("p",null,"\u53c2\u8003 Webpack \u5b98\u65b9\u5347\u7ea7\u65b9\u6848\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://webpack.js.org/migrate/5/"},"To v5 from v4")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://webpack.js.org/migrate/4/"},"To v4 from v3")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://webpack.js.org/migrate/3/"},"To v2 or v3 from v1"))),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://juejin.cn/post/7161303856943464455"},"\u6781\u81f4\u7f16\u8bd1\u901f\u5ea6\uff0c\u4e00\u6587\u641e\u5b9awebpack5\u5347\u7ea7")),(0,a.kt)("h2",{id:"\u63d2\u4ef6\u5347\u7ea7\u65b9\u6848"},"\u63d2\u4ef6\u5347\u7ea7\u65b9\u6848"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6e05\u7406\u76ee\u5f55\u63d2\u4ef6\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"clean-webpack-plugin")," -> Webpack5 \u5185\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"output.clean")," \u914d\u7f6e\u9879\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u70ed\u66f4\u65b0\u63d2\u4ef6\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"HotModuleReplacementPlugin")," -> Webpack5 \u914d\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"devServer.hot = true")," \u65f6\u81ea\u52a8\u542f\u7528\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u4ee3\u7801\u538b\u7f29\u63d2\u4ef6\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"uglify-js-webpack-plugin")," -> Webpack5 \u5185\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"terser-webpack-plugin")," (\u751f\u4ea7\u73af\u5883\u4e0b\u4f7f\u7528\uff0c\u79fb\u9664\u4ee3\u7801\u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"debugger")," \u548c ",(0,a.kt)("inlineCode",{parentName:"li"},"console.*"),") \uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u62bd\u53d6\u516c\u5171\u6a21\u5757\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"CommonChunksPlugin")," -> Webpack5 \u5185\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"optimization.splitChunks")," \uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u62bd\u53d6 CSS \u63d2\u4ef6\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"extract-text-webpack-plugin")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"mini-css-extract-plugin")," (\u751f\u4ea7\u73af\u5883\u4e0b\u4f7f\u7528\uff0c\u5f00\u53d1\u73af\u5883\u4e0b\u4e3a\u4e86\u8ba9\u6837\u5f0f\u6e90\u6587\u4ef6\u4e5f\u80fd\u88ab\u70ed\u66ff\u6362\uff0c\u4e0d\u80fd\u62bd\u53d6\u6837\u5f0f\uff0c\u800c\u662f\u968f JS Bundle \u4e00\u8d77\u8f93\u51fa) \uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u538b\u7f29 CSS \u63d2\u4ef6\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"optimize-css-assets-webpack-plugin")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"css-minimizer-webpack-plugin")," (\u751f\u4ea7\u73af\u5883\u4e0b\u4f7f\u7528) \uff1b"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"NamedModulesPlugin")," ->  Webpack5 \u5185\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"optimization.moduleIds: 'named'")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"NamedChunksPlugin")," ->  Webpack5 \u5185\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"optimization.chunkIds: 'named'")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"HashedModuleIdsPlugin")," ->  Webpack5 \u4e0d\u518d\u9700\u8981\uff0c\u6539\u4e3a\u5185\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"optimization.moduleIds: 'deterministic'"),"\uff08\u751f\u4ea7\u73af\u5883\u9ed8\u8ba4\u542f\u7528\uff09"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"optimization.splitChunks.cacheGroups.vendors")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"optimization.splitChunks.cacheGroups.defaultVendors")),(0,a.kt)("li",{parentName:"ul"},"Rule.loaders -> Rule.use\uff08\u6ce8\u610f loaders \u5df2\u7ecf\u5e9f\u5f03\u4e86\uff0c\u4f46\u662f loader \u8fd8\u662f\u53ef\u7528\u7684\uff0c\u76f8\u5f53\u4e8e Rule.use: ","[ { loader } ]"," \u7b80\u5199\uff09"),(0,a.kt)("li",{parentName:"ul"},"\u672c\u5730\u5f00\u53d1\u547d\u4ee4\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"webpack-cli")," \u652f\u6301 ",(0,a.kt)("inlineCode",{parentName:"li"},"webpack serve")," \u542f\u52a8 devServer"),(0,a.kt)("li",{parentName:"ul"},"\u5176\u4ed6\u63d2\u4ef6\u4f8b\u5982 ",(0,a.kt)("inlineCode",{parentName:"li"},"html-webpack-plugin")," \u867d\u7136\u4e0d\u7528\u6362\uff0c\u4f46\u4e5f\u9700\u8981\u5347\u7ea7\u5230\u652f\u6301 Webpack5 \u7684\u7248\u672c\uff1b")),(0,a.kt)("h2",{id:"\u914d\u7f6e\u4f18\u5316\u65b9\u6848"},"\u914d\u7f6e\u4f18\u5316\u65b9\u6848"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u9759\u6001\u8d44\u6e90\u5904\u7406\uff0c\u56fe\u7247\u3001\u5b57\u4f53\u6253\u5305\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"url-loader")," -> Webpack5 \u5185\u7f6e Asset Modules\uff08\u503c\u6709\u56db\u79cd\uff0c",(0,a.kt)("inlineCode",{parentName:"li"},"asset/resource")," \u5bf9\u5e94 ",(0,a.kt)("inlineCode",{parentName:"li"},"file-loader"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"asset/inline")," \u5bf9\u5e94",(0,a.kt)("inlineCode",{parentName:"li"},"url-loader"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"asset/source")," \u5bf9\u5e94 ",(0,a.kt)("inlineCode",{parentName:"li"},"raw-loader"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"asset")," \u6839\u636e\u8d44\u6e90\u5927\u5c0f\u81ea\u52a8\u9009\u62e9 ",(0,a.kt)("inlineCode",{parentName:"li"},"resource")," \u6216\u8005 ",(0,a.kt)("inlineCode",{parentName:"li"},"inline"),"\uff09\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u6a21\u5757\u6784\u5efa\u7f13\u5b58\uff08Webpack 4 \u9700\u8981\u624b\u52a8\u914d\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"cache-loader"),"\uff09"),(0,a.kt)("li",{parentName:"ul"},"\u6587\u4ef6\u54c8\u5e0c\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"fullhash"),"\uff08\u5bf9\u5e94 Webpack 4 \u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"hash"),"\uff09\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"chunkhash"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"contenthash"),"\u3002Webpack 5 \u5bf9 ",(0,a.kt)("inlineCode",{parentName:"li"},"contenthash")," \u8fdb\u884c\u4f18\u5316\uff0c\u5728\u7f13\u5b58\u6548\u7387\u4e0a\u6709\u66f4\u597d\u7684\u5229\u7528\u3002\u65e0\u7279\u6b8a\u573a\u666f\uff0c\u5efa\u8bae\u90fd\u7528 ",(0,a.kt)("inlineCode",{parentName:"li"},"contenthash"),"\uff08\u751f\u4ea7\u73af\u5883\u4e0b\u4f7f\u7528\uff09\uff1b"),(0,a.kt)("li",{parentName:"ul"},"\u9009\u62e9\u66f4\u52a0\u5feb\u901f\u7684\u54c8\u5e0c\u51fd\u6570\uff1aWebpack v5.54.0+ \u652f\u6301 ",(0,a.kt)("inlineCode",{parentName:"li"},'output.hashFunction: "xxhash64"')," \u66ff\u6362\u9ed8\u8ba4\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"md4")," \u54c8\u5e0c\u51fd\u6570"),(0,a.kt)("li",{parentName:"ul"},"\u652f\u6301\u8fd0\u884c\u65f6\u4ee3\u7801\u5355\u72ec\u5206\u5305\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},'optimization.runtimeChunk: "single"'),"\uff0c\u9ed8\u8ba4\u5206\u5305\u89c4\u5219 Initial Chunk\u3001Async Chunk \u57fa\u7840\u4e0a\u65b0\u589e\u4e00\u79cd Runtime Chunk"),(0,a.kt)("li",{parentName:"ul"},"\u9488\u5bf9 re-export \u573a\u666f\u4f18\u5316\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"optimization.providedExports: true"),"\uff0c\u914d\u5408 ",(0,a.kt)("inlineCode",{parentName:"li"},"optimization.sideEffects: true")," \u53ef\u4ee5\u5b9e\u73b0\u7b2c\u4e09\u65b9\u5e93\u6309\u9700\u6253\u5305\uff08\u4f8b\u5982 antd@v5\u3001ahooks\uff09\uff0c\u914d\u5408 ",(0,a.kt)("inlineCode",{parentName:"li"},"optimization.usedExports: true")," \u542f\u7528\u6a21\u5757\u6807\u8bb0\u53ef\u4ee5\u5b9e\u73b0 Tree-Shaking"),(0,a.kt)("li",{parentName:"ul"},"Module Federation\uff08\u6a21\u5757\u8054\u90a6\u8ba9 Webpack \u8fbe\u5230\u4e86\u7ebf\u4e0a Runtime \u7684\u6548\u679c\uff0c\u8ba9\u4ee3\u7801\u76f4\u63a5\u5728\u9879\u76ee\u95f4\u5229\u7528 CDN \u76f4\u63a5\u5171\u4eab\uff0c\u4e0d\u518d\u9700\u8981\u672c\u5730\u5b89\u88c5 Npm \u5305\u3001\u6784\u5efa\u518d\u53d1\u5e03\u4e86\uff09"),(0,a.kt)("li",{parentName:"ul"},"\u4e0d\u518d\u5185\u7f6e Node.js polyfill\uff0c\u5982\u679c\u7528\u5230 Node \u5185\u7f6e\u6a21\u5757\u9700\u8981\u81ea\u884c\u5b89\u88c5 polyfill")),(0,a.kt)("h2",{id:"\u57fa\u4e8e-react--typescript-\u7684-webpack5-\u914d\u7f6e\u6700\u4f73\u5b9e\u8df5"},"\u57fa\u4e8e React + TypeScript \u7684 Webpack5 \u914d\u7f6e\u6700\u4f73\u5b9e\u8df5"),(0,a.kt)("h3",{id:"packagejson-\u914d\u7f6e"},(0,a.kt)("inlineCode",{parentName:"h3"},"package.json")," \u914d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "webpack-antd5-treeshaking",\n  "version": "1.0.0",\n  "description": "",\n  "main": "index.js",\n  "scripts": {\n    "serve": "cross-env NODE_ENV=development webpack serve --config config/webpack.config.js",\n    "build:dev": "cross-env NODE_ENV=development webpack --config config/webpack.config.js",\n    "build:prod": "cross-env NODE_ENV=production webpack --config config/webpack.config.js",\n    "build:analyze": "cross-env NODE_ENV=production ANALYZE=true webpack --config config/webpack.config.js",\n  },\n  "keywords": [],\n  "author": "",\n  "license": "ISC",\n  "browserslist": {\n    "production": [\n      ">0.2%",\n      "not dead",\n      "not op_mini all"\n    ],\n    "development": [\n      "last 1 chrome version",\n      "last 1 firefox version",\n      "last 1 safari version"\n    ]\n  },\n  "devDependencies": {\n    "@babel/core": "^7.20.7",\n    "@babel/preset-env": "^7.20.2",\n    "@babel/preset-react": "^7.18.6",\n    "@babel/preset-typescript": "^7.18.6",\n    "@types/node": "^18.11.18",\n    "@types/react": "^18.0.26",\n    "@types/react-dom": "^18.0.10",\n    "babel-loader": "^9.1.0",\n    "webpack": "^5.75.0",\n    "webpack-bundle-analyzer": "^4.7.0",\n    "webpack-cli": "^5.0.1",\n    "webpack-dev-server": "^4.11.1",\n    "webpackbar": "^5.0.2"\n  },\n  "dependencies": {\n    "antd": "^5.1.2",\n    "react": "^18.2.0",\n    "react-dom": "^18.2.0"\n  }\n}\n')),(0,a.kt)("h4",{id:"webpack-\u76f8\u5173"},"Webpack \u76f8\u5173"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"webpack")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"webpack-cli")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"webpack-dev-server"))),(0,a.kt)("h4",{id:"babel-\u76f8\u5173"},"Babel \u76f8\u5173"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"@babel/core"),"\uff1aBabel \u6838\u5fc3\u5e93"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"@babel/preset-env"),"\uff1a\u8f6c\u8bd1 ES Next \u8bed\u6cd5\u7684\u63d2\u4ef6\u96c6"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"@babel/preset-react"),"\uff1a\u8f6c\u8bd1 React JSX \u8bed\u6cd5\u7684\u63d2\u4ef6\u96c6"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"@babel/preset-typescript"),"\uff1a\u8f6c\u8bd1 TypeScript \u8bed\u6cd5\u7684\u63d2\u4ef6\u96c6"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"babel-loader"),"\uff1aBabel \u914d\u5408 Webpack \u4f7f\u7528\u9700\u8981\u5b89\u88c5\uff0c\u5982\u679c\u76f4\u63a5\u901a\u8fc7\u547d\u4ee4\u884c\u7f16\u8bd1\u53ef\u4ee5\u7528 ",(0,a.kt)("inlineCode",{parentName:"li"},"@babel/cli"))),(0,a.kt)("h4",{id:"react-\u76f8\u5173"},"React \u76f8\u5173"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"react")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"react-dom")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"antd")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"classnames"))),(0,a.kt)("h4",{id:"typescript-\u7c7b\u578b\u5b9a\u4e49\u5e93"},"TypeScript \u7c7b\u578b\u5b9a\u4e49\u5e93"),(0,a.kt)("p",null,"\u7531\u4e8e React \u63d0\u4f9b\u7684\u662f CJS \u5305\uff0c\u672c\u8eab\u6ca1\u6709\u7c7b\u578b\u5b9a\u4e49\uff0c\u9700\u8981\u5355\u72ec\u5b89\u88c5"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"@types/react")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"@types/react-dom"))),(0,a.kt)("p",null,"\u5b89\u88c5 Node \u7c7b\u578b\u5b9a\u4e49\u5e93\uff0c\u5728 Webpack \u914d\u7f6e\u4e2d\u901a\u8fc7 Node \u524d\u7f00 ",(0,a.kt)("inlineCode",{parentName:"p"},"node:")," \u65b9\u5f0f\u5bfc\u5165\u6a21\u5757\u53ef\u4ee5\u83b7\u5f97\u7c7b\u578b\u63d0\u793a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"@types/node"))),(0,a.kt)("h4",{id:"\u7b2c\u4e09\u65b9-helpers"},"\u7b2c\u4e09\u65b9 helpers"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"react-dev-utils"),"\uff1aCRA \u7684 utils \u5305\uff0c\u63d0\u4f9b\u975e\u5e38\u591a\u7684\u5de5\u5177\u51fd\u6570"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"eslint-config-react-app"),"\uff1aCRA \u7684 ESLint \u914d\u7f6e"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"babel-preset-react-app"),"\uff1aCRA \u7684 Babel \u914d\u7f6e")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"\u5bf9\u4e8e\u524d\u7aef\u5de5\u7a0b\u5e38\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"babel")," \u914d\u7f6e\u5efa\u8bae\u638c\u63e1\uff0c\u53ef\u4ee5\u53c2\u8003 ",(0,a.kt)("strong",{parentName:"p"},"\u524d\u7aef\u9879\u76ee Babel \u914d\u7f6e"),"\u3002\u5bf9\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"postcss")," \u53ef\u4ee5\u76f4\u63a5\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"postcss-preset-env"),"\uff0c\u5bf9\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"eslint")," \u53ef\u4ee5\u76f4\u63a5\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"eslint-config-react-app"),"\u3002")),(0,a.kt)("h3",{id:"webpackconfigjs-\u914d\u7f6e"},(0,a.kt)("inlineCode",{parentName:"h3"},"webpack.config.js")," \u914d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require(\"node:fs\");\nconst path = require(\"node:path\");\nconst webpack = require(\"webpack\");\nconst HtmlWebpackPlugin = require(\"html-webpack-plugin\");\nconst CaseSensitivePathsPlugin = require('case-sensitive-paths-webpack-plugin');\nconst TerserPlugin = require('terser-webpack-plugin');\nconst MiniCssExtractPlugin = require(\"mini-css-extract-plugin\");\nconst CssMinimizerPlugin = require('css-minimizer-webpack-plugin');\nconst ESLintPlugin = require('eslint-webpack-plugin');\nconst ForkTsCheckerWebpackPlugin = require('fork-ts-checker-webpack-plugin');\nconst ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin');\nconst Webpackbar = require('webpackbar');\nconst BundleAnalyzerPlugin = require(\"webpack-bundle-analyzer\").BundleAnalyzerPlugin;\n\nconst appPath = process.cwd();\nconst appBuild = path.resolve(appPath, \"dist\");\nconst appHtml = path.resolve(appPath, \"public/index.html\");\nconst appSrc = path.resolve(appPath, \"src\");\nconst appTsConfig = path.resolve(appPath, \"tsconfig.json\");\nconst appNodeModules = path.resolve(appPath, \"node_modules\");\nconst appWebpackCache = path.resolve(appPath, \"node_modules/.cache\");\nconst appTsBuildInfoFile = path.resolve(appPath, \"node_modules/.cache/tsconfig.tsbuildinfo\");\n\nconst isEnvDevelopment = process.env.NODE_ENV === \"development\";\nconst isEnvProduction = process.env.NODE_ENV === \"production\";\nconst useBundleAnalyzer = process.env.ANALYZE === \"true\";\nconst useTypeScript = fs.existsSync(appTsConfig);\n\nmodule.exports = {\n  mode: isEnvDevelopment ? \"development\" : \"production\",\n  // \u5f00\u53d1\u73af\u5883\u4f7f\u7528 `eval-cheap-module-source-map`\uff0c\u786e\u4fdd\u6700\u4f73\u7f16\u8bd1\u901f\u5ea6\n  // \u751f\u4ea7\u73af\u5883\u4e0d\u5f00\u542f\u6216\u8005\u4f7f\u7528 `hidden-source-map`\n  devtool: isEnvDevelopment ? \"eval-cheap-module-source-map\" : false,\n  entry: {\n    main: path.resolve(appPath, \"src/index.js\"),\n    puzzleEntry: path.resolve(appPath, \"src/studentPuzzle.js\"),\n  },\n  output: {\n    // \u6253\u5305\u4ea7\u7269\u7684\u6587\u4ef6\u5939\n    path: appBuild,\n    // JS \u8d44\u6e90\u7528 contenthash\uff0c\u63d0\u5347\u7f13\u5b58\u590d\u7528\u7387\uff0c\u5f00\u53d1\u73af\u5883\u4e0d\u7528\u54c8\u5e0c\uff0c\u63d0\u5347\u6784\u5efa\u6548\u7387\n    filename: isEnvProduction ? \"static/js/[name].[contenthash:8].js\" : \"static/js/[name].js\",\n    // \u57fa\u4e8e Code-Splitting \u5206\u5305\u7684\u5f02\u6b65 chunk\uff0c\u5f00\u53d1\u73af\u5883\u4e0d\u7528\u54c8\u5e0c\uff0c\u63d0\u5347\u6784\u5efa\u6548\u7387\n    chunkFilename: isEnvProduction ? \"static/js/[name].[contenthash:8].chunk.js\" : \"static/js/[name].chunk.js\",\n    // Asset Module \u6253\u5305\u56fe\u7247\u3001\u5b57\u4f53\u7684\u8f93\u51fa\u8def\u5f84\n    assetModuleFilename: 'static/media/[name].[hash][ext]',\n    // \u9759\u6001\u8d44\u6e90\u524d\u7f00\uff0c\u975e\u6839\u8def\u5f84\u90e8\u7f72\uff0c\u6216\u8005\u751f\u4ea7\u73af\u5883\u9759\u6001\u8d44\u6e90\u4e0a\u4f20 CDN \u4f1a\u7528\u5230\n    publicPath: \"auto\",\n    // \u6307\u5b9a Async Chunk \u7684\u52a0\u8f7d\u65b9\u5f0f\n    // \u9ed8\u8ba4 `jsonp`\uff0c\u53ef\u4ee5\u6539\u4e3a `import`\uff0c\u4f46\u662f\u9700\u8981\u6ce8\u610f\u517c\u5bb9\u6027\u95ee\u9898\n    // chunkLoading: \"import\",\n    // \u6307\u5b9a\u7528\u4e8e jsonp \u52a0\u8f7d\u7684\u5168\u5c40\u53d8\u91cf\n    // chunkLoadingGlobal: \"myCustomFunc\",\n    // \u9009\u62e9\u4e00\u4e2a\u66f4\u52a0\u5feb\u901f\u7684 hash \u51fd\u6570\uff0c\u5373\u53ef\u51cf\u5c11 CPU \u6d88\u8017\uff0c\u5e76\u63d0\u5347\u6253\u5305\u901f\u5ea6\n    // \u6bd4\u5982\u5c06\u9ed8\u8ba4\u7684 `md4` \u6362\u6210 `xxhash64`\n    hashFunction: \"xxhash64\",\n    // \u6e05\u7a7a\u6253\u5305\u8f93\u51fa\u76ee\u5f55\n    clean: true,\n  },\n  stats: \"errors-warnings\",\n  module: {\n    rules: [\n      {\n        // \u4f7f\u7528 `Rule.oneOf`\uff0c\u4e00\u65e6 loader \u5339\u914d\u6210\u529f\u5c31\u9000\u51fa\u5339\u914d\uff0c\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u5339\u914d\u6b21\u6570\n        oneOf: [\n          // \u5904\u7406\u4e1a\u52a1\u4ee3\u7801 js\u3001jsx\u3001ts\u3001tsx \u6587\u4ef6\n          // \u7b2c\u4e09\u65b9\u5e93\u4ee3\u7801\u8df3\u8fc7\u6784\u5efa\u76f4\u63a5\u6253\u5305\uff0c\u6700\u5c0f\u5316 loader \u4f5c\u7528\u8303\u56f4\n          {\n            test: /\\.(js|mjs|jsx|ts|tsx)$/,\n            include: [\n              // \u6700\u5c0f\u5316 loader \u4f5c\u7528\u8303\u56f4\n              // \u5982\u679c\u6709\u7b2c\u4e09\u65b9\u5e93\u4ee3\u7801\u7528\u4e86 ES6 \u8bed\u6cd5\uff0c\u9700\u8981\u5355\u72ec\u6dfb\u52a0 babel-loader \u5904\u7406\n              appSrc,\n              path.resolve(appPath, 'node_modules/@study/common-ykt-puzzles/'),\n            ],\n            // babel \u914d\u7f6e\u53c2\u8003\uff1a\u524d\u7aef\u9879\u76ee Babel \u914d\u7f6e\n            loader: require.resolve('babel-loader'),\n            options: {\n              plugins: [\n                // \u5f00\u53d1\u73af\u5883\u542f\u7528 `react-refresh` \u70ed\u66f4\u65b0 React \u7ec4\u4ef6\n                isEnvDevelopment &&\n                  require.resolve('react-refresh/babel'),\n              ].filter(Boolean),\n              // \u542f\u7528 babel-loader \u7f13\u5b58\u80fd\u529b\n              // Webpack5 \u81ea\u5e26\u7684\u6301\u4e45\u5316\u7f13\u5b58\u7c92\u5ea6\u592a\u5927\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u5c31\u4f1a\u5bfc\u81f4\u7f13\u5b58\u5931\u6548\n              // This is a feature of `babel-loader` for webpack (not Babel itself).\n              // It enables caching results in\n              // directory for faster rebuilds.\n              cacheDirectory: true,\n              // See #6846 for context on why cacheCompression is disabled\n              cacheCompression: false,\n              compact: isEnvProduction,\n            }\n          },\n          // \u5904\u7406\u4e1a\u52a1\u4ee3\u7801\u548c\u7ec4\u4ef6\u5e93 css\u3001less \u6587\u4ef6\n          // \u53ef\u4ee5\u7ed9\u666e\u901a css \u548c css module \u914d\u7f6e\u4e24\u5957\u89c4\u5219\n          {\n            test: /\\.(css|less)$/i,\n            // include: /node_modules/,\n            use: [\n              isEnvDevelopment\n                ? // \u5f00\u53d1\u73af\u5883\u5c06\u6837\u5f0f\u6ce8\u5165 style \u6807\u7b7e\u5b9e\u73b0\u6837\u5f0f\u70ed\u66f4\u65b0\n                  \"style-loader\"\n                : // \u751f\u4ea7\u73af\u5883\u4e0b\u5c06 CSS \u62bd\u53d6\u5230\u5355\u72ec\u7684\u6837\u5f0f\u6587\u4ef6\u4e2d\n                  MiniCssExtractPlugin.loader,\n              {\n                loader: \"css-loader\",\n                options: {\n                  sourceMap: isEnvDevelopment,\n                  importLoaders: 2,\n                },\n              },\n              {\n                // \u76f4\u63a5\u7528 postcss-preset-env\uff0c\u5f00\u7bb1\u5373\u7528\u65e0\u9700\u5355\u72ec\u914d\u7f6e\n                // \u6ce8\u610f postcss-loader \u4f1a\u8bfb\u53d6\u9879\u76ee\u6839\u76ee\u5f55\u7684 package.json \u4e2d\u7684 `browserslist` \u914d\u7f6e\n                // Options for PostCSS as we reference these options twice\n                // Adds vendor prefixing based on your specified browser support in\n                // package.json\n                loader: require.resolve('postcss-loader'),\n                options: {\n                  postcssOptions: {\n                    // Necessary for external CSS imports to work\n                    // https://github.com/facebook/create-react-app/issues/2677\n                    ident: 'postcss',\n                    config: false,\n                    plugins: [\n                      'postcss-flexbugs-fixes',\n                      [\n                        'postcss-preset-env',\n                        {\n                          autoprefixer: {\n                            flexbox: 'no-2009',\n                          },\n                          stage: 3,\n                        },\n                      ],\n                      // \u4e0d\u9700\u8981 postcss \u63d0\u4f9b\u7684 CSS Reset \u9009\u9879\n                      // \u4e00\u822c\u7ec4\u4ef6\u5e93\u4f8b\u5982 Antd \u90fd\u4f1a\u5185\u7f6e CSS Reset\n                      // 'postcss-normalize',\n                    ],\n                  },\n                  sourceMap: isEnvDevelopment,\n                },\n              },\n              {\n                loader: 'less-loader',\n                options: {\n                  lessOptions: {\n                    javascriptEnabled: true,\n                    modifyVars: {},\n                  },\n                },\n              },\n            ],\n            // Don't consider CSS imports dead code even if the\n            // containing package claims to have no side effects.\n            // Remove this when webpack adds a warning or an error for this.\n            // See https://github.com/webpack/webpack/issues/6571\n            sideEffects: true,\n          },\n          // \u4f7f\u7528 `@svgr/webpack` \u5c06 SVG \u56fe\u6807\u8f6c\u4e3a React \u7ec4\u4ef6\n          // \u53ef\u4ee5\u652f\u6301\u56fe\u6807\u50cf\u5b57\u4f53\u4e00\u6837\u8bbe\u7f6e `color`\u3001`font-size` \u7b49\u5c5e\u6027\n          {\n            test: /\\.svg$/,\n            use: [\n              {\n                loader: require.resolve('@svgr/webpack'),\n                options: {\n                  prettier: false,\n                  svgo: false,\n                  svgoConfig: {\n                    plugins: [{ removeViewBox: false }],\n                  },\n                  titleProp: true,\n                  ref: true,\n                },\n              },\n              {\n                loader: require.resolve('file-loader'),\n                options: {\n                  name: 'static/media/[name].[hash].[ext]',\n                },\n              },\n            ],\n            issuer: {\n              and: [/\\.(ts|tsx|js|jsx|md|mdx)$/],\n            },\n          },\n          // \u56fe\u7247\u3001\u5b57\u4f53\u6253\u5305\uff0c\u6839\u636e\u8d44\u6e90\u5927\u5c0f\u81ea\u52a8\u9009\u62e9 `resource` \u6216\u8005 `inline`\n          // \u5982\u679c\u9700\u8981\u5f3a\u5236 inline \u53ef\u4ee5\u914d\u7f6e `type: \"asset/inline\"`\n          {\n            test: /\\.(woff|woff2|ttf|eot|svg)$/,\n            exclude: /node_modules/,\n            type: 'asset',\n          },\n          {\n            test: /\\.(png|jpg|gif|jpeg|ico|cur)$/,\n            exclude: /node_modules/,\n            type: 'asset',\n          },\n        ]\n      }\n    ]\n  },\n  resolve: {\n    // \u9650\u5236\u7b2c\u4e09\u65b9\u5e93\u641c\u7d22\u8303\u56f4\uff0c\u5173\u95ed\u9010\u5c42\u641c\u7d22\u529f\u80fd\n    // modules: [appNodeModules],\n    // \u4ee3\u7801\u4e2d\u5c3d\u91cf\u8865\u9f50\u6587\u4ef6\u540e\u7f00\u540d\uff0c\u51cf\u5c11\u5339\u914d\u6b21\u6570\n    // \u5e38\u7528\u7684\u524d\u7f00\u653e\u5728\u524d\u9762\uff0c\u4e5f\u53ef\u63d0\u5347\u5339\u914d\u6548\u7387\n    extensions: ['.ts', '.tsx', '.js', '.jsx', '.json', '.wasm'].filter(ext => useTypeScript || !ext.includes('ts')),\n    alias: {\n      \"@\": appSrc,\n    },\n    // Webpack5 \u4e0d\u518d\u63d0\u4f9b Node polyfill\uff0c\u5982\u679c\u7528\u5230\u8fd9\u4e9b\u6a21\u5757\u9700\u8981\u5355\u72ec\u5b89\u88c5\n    // fallback: {\n    //   crypto: require.resolve(\"crypto-browserify\"),\n    //   stream: require.resolve(\"stream-browserify\"),\n    //   buffer: require.resolve(\"buffer/\"),\n    // },\n  },\n  cache: {\n    type: 'filesystem',\n    cacheDirectory: appWebpackCache,\n    store: 'pack',\n    buildDependencies: {\n      defaultWebpack: ['webpack/lib/'],\n      config: [__filename],\n      tsconfig: useTypeScript ? [appTsConfig] : [],\n    },\n  },\n  devServer: {\n    static: appBuild,\n    compress: true,\n    // `hot: true` \u81ea\u52a8\u5e94\u7528 `HotModuleReplacementPlugin` \u63d2\u4ef6\n    hot: true,\n    open: true,\n    // \u652f\u6301\u5386\u53f2\u6a21\u5f0f\u8def\u7531\u91cd\u5b9a\u5411\n    historyApiFallback: true,\n    host: '0.0.0.0',\n    port: 8066,\n    setupMiddlewares: (middlewares, devServer) => {\n      // \u8bbe\u7f6e express \u4e2d\u95f4\u4ef6\uff0c\u53c2\u8003\uff1a\n      // https://webpack.js.org/configuration/dev-server/#devserversetupmiddlewares\n      return middlewares;\n    },\n  },\n  plugins: [\n    new Webpackbar(),\n    useBundleAnalyzer && new BundleAnalyzerPlugin(),\n    new HtmlWebpackPlugin({\n      template: appHtml,\n      title: \"React App\",\n      filename: \"index.html\",\n      ...(isEnvProduction && {\n        minify: {\n          removeComments: true,\n          collapseWhitespace: true,\n          removeRedundantAttributes: true,\n          useShortDoctype: true,\n          removeEmptyAttributes: true,\n          removeStyleLinkTypeAttributes: true,\n          keepClosingSlash: true,\n          minifyJS: true,\n          minifyCSS: true,\n          minifyURLs: true,\n        },\n      }),\n    }),\n    new webpack.DefinePlugin({\n      'process.env.NODE_ENV': isEnvDevelopment ? '\"development\"' : '\"production\"',\n      __DEV__: isEnvDevelopment,\n    }),\n    isEnvProduction &&\n      // \u751f\u4ea7\u73af\u5883\u4e0b\u62bd\u63d0\u6837\u5f0f\n      // \u6ce8\u610f `MiniCssExtractPlugin` \u4ec5\u5728\u751f\u4ea7\u73af\u5883\u4e0b\u542f\u7528\uff0c\u6587\u4ef6\u540d\u54c8\u5e0c\u4e5f\u4ec5\u7528\u4e8e\u751f\u4ea7\u73af\u5883\n      new MiniCssExtractPlugin({\n        filename: 'static/css/[name].[contenthash:8].css',\n        chunkFilename: 'static/css/[name].[contenthash:8].chunk.css',\n        // \u89e3\u51b3\u7528\u4e86 antd \u7ec4\u4ef6\u5e93\u4e4b\u540e\uff0c\u62bd\u63d0\u6837\u5f0f\u51b2\u7a81\u95ee\u9898\n        ignoreOrder: true,\n      }),\n    isEnvDevelopment &&\n      new ReactRefreshWebpackPlugin({\n        overlay: false,\n      }),\n    isEnvDevelopment && new CaseSensitivePathsPlugin(),\n    useTypeScript &&\n      new ForkTsCheckerWebpackPlugin({\n        async: isEnvDevelopment,\n        typescript: {\n          typescriptPath: resolve.sync('typescript', {\n            basedir: appNodeModules,\n          }),\n          configOverwrite: {\n            compilerOptions: {\n              sourceMap: isEnvDevelopment,\n              skipLibCheck: true,\n              inlineSourceMap: false,\n              declarationMap: false,\n              noEmit: true,\n              incremental: true,\n              tsBuildInfoFile: appTsBuildInfoFile,\n            },\n          },\n          context: appPath,\n          diagnosticOptions: {\n            syntactic: true,\n          },\n          mode: 'write-references',\n          // profile: true,\n        },\n        issue: {\n          // This one is specifically to match during CI tests,\n          // as micromatch doesn't match\n          // '../cra-template-typescript/template/src/App.tsx'\n          // otherwise.\n          include: [\n            { file: '../**/src/**/*.{ts,tsx}' },\n            { file: '**/src/**/*.{ts,tsx}' },\n          ],\n          exclude: [\n            { file: '**/src/**/__tests__/**' },\n            { file: '**/src/**/?(*.){spec|test}.*' },\n            { file: '**/src/setupProxy.*' },\n            { file: '**/src/setupTests.*' },\n          ],\n        },\n        logger: {\n          infrastructure: 'silent',\n        },\n      }),\n    // \u5f00\u53d1\u73af\u5883\u4e0b\u542f\u7528 `ESLintPlugin`\n    // \u751f\u4ea7\u73af\u5883\u4e0b\u7981\u7528\uff0c\u786e\u4fdd\u6700\u4f73\u7f16\u8bd1\u901f\u5ea6\n    isEnvDevelopment &&\n      new ESLintPlugin({\n        // Plugin options\n        extensions: ['js', 'mjs', 'jsx', 'ts', 'tsx'],\n        formatter: require.resolve('react-dev-utils/eslintFormatter'),\n        eslintPath: require.resolve('eslint'),\n        // \u672c\u5730\u5f00\u53d1\u73af\u5883\u4e0b\u5c06 ESLint \u62a5\u9519\u8f6c\u4e3a warnings\n        failOnError: false,\n        context: appSrc,\n        // \u542f\u7528 ESLint \u7f13\u5b58\n        cache: true,\n        cacheLocation: path.resolve(\n          appPath,\n          'node_modules/.cache/.eslintcache'\n        ),\n        // ESLint class options\n        cwd: appPath,\n        resolvePluginsRelativeTo: __dirname,\n        baseConfig: {\n          extends: [require.resolve('eslint-config-react-app/base')],\n          // React 17 \u4e4b\u524d\uff0cclassic JSX \u8bed\u6cd5\u5fc5\u987b\u663e\u5f0f import React\n          // React 17 \u5f00\u59cb\u652f\u6301 automatic JSX\uff0c\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u5f15\u5165 jsx \u5165\u53e3\uff0c\u65e0\u9700\u5f00\u53d1\u8005\u624b\u52a8 import\n          // \u56e0\u6b64\u8fd9\u91cc\u5173\u95ed ESLint \u76f8\u5173\u89c4\u5219\n          rules: {\n            'react/jsx-uses-react': 'off',\n            'react/react-in-jsx-scope': 'off',\n          },\n        },\n      }),\n  ].filter(Boolean),\n  optimization: {\n    minimize: isEnvProduction,\n    minimizer: [\n      // \u4ec5\u5728\u751f\u4ea7\u73af\u5883\u4e0b\u542f\u7528\uff0cTerser \u538b\u7f29\u9ed8\u8ba4\u542f\u7528 parallel\n      new TerserPlugin({\n        terserOptions: {\n          parse: {\n            // We want terser to parse ecma 8 code. However, we don't want it\n            // to apply any minification steps that turns valid ecma 5 code\n            // into invalid ecma 5 code. This is why the 'compress' and 'output'\n            // sections only apply transformations that are ecma 5 safe\n            // https://github.com/facebook/create-react-app/pull/4234\n            ecma: 8,\n          },\n          compress: {\n            ecma: 5,\n            warnings: false,\n            // Disabled because of an issue with Uglify breaking seemingly valid code:\n            // https://github.com/facebook/create-react-app/issues/2376\n            // Pending further investigation:\n            // https://github.com/mishoo/UglifyJS2/issues/2011\n            comparisons: false,\n            // Disabled because of an issue with Terser breaking valid code:\n            // https://github.com/facebook/create-react-app/issues/5250\n            // Pending further investigation:\n            // https://github.com/terser-js/terser/issues/120\n            inline: 2,\n            // \u751f\u4ea7\u73af\u5883\u6253\u5305\u79fb\u9664 console\n            drop_console: true,\n          },\n          mangle: {\n            safari10: true,\n          },\n          // Added for profiling in devtools\n          // keep_classnames: isEnvProductionProfile,\n          // keep_fnames: isEnvProductionProfile,\n          output: {\n            ecma: 5,\n            comments: false,\n            // Turned on because emoji and regex is not minified properly using default\n            // https://github.com/facebook/create-react-app/issues/2488\n            ascii_only: true,\n          },\n        },\n      }),\n      // \u4ec5\u5728\u751f\u4ea7\u73af\u5883\u4e0b\u542f\u7528\n      new CssMinimizerPlugin(),\n    ],\n    // Webpack \u8fd0\u884c\u65f6\u4ee3\u7801\u5355\u72ec\u5206\u5305\n    runtimeChunk: 'single',\n    splitChunks: {\n      // `SplitChunksPlugin` \u9ed8\u8ba4\u53ea\u5bf9 Async Chunk \u751f\u6548\uff0cInitial Chunk \u4e0d\u8fdb\u884c\u62c6\u5305\u5904\u7406\n      // \u5b57\u7b26\u4e32 `'all'` \uff1a\u5bf9 Initial Chunk \u4e0e Async Chunk \u90fd\u751f\u6548\n      chunks: \"all\",\n      cacheGroups: {\n        // \u9488\u5bf9\u4e1a\u52a1\u7ec4\u4ef6\u5e93\u7684\u7f13\u5b58\u7ec4\n        commons: {\n          test: /[\\\\/]node_modules[\\\\/]@study[\\\\/]/,\n          name: 'commons',\n          chunks: 'all',\n        },\n        // \u9488\u5bf9 antd \u7684\u7f13\u5b58\u7ec4\n        vendor: {\n          test: /[\\\\/]node_modules[\\\\/](antd|@ant-design|rc-.*?)[\\\\/]/,\n          name: 'vendor',\n          chunks: 'all',\n          enforce: true,\n        },\n        // Extracting all CSS/less in a single file\n        styles: {\n          name: 'styles',\n          test: /\\.(c|le)ss$/,\n          chunks: 'all',\n          enforce: true,\n        },\n      }\n    }\n  },\n}\n")),(0,a.kt)("h2",{id:"\u5982\u4f55\u57fa\u4e8e-chain-webpack-\u548c-typescript-\u7f16\u5199-webpack-\u914d\u7f6e"},"\u5982\u4f55\u57fa\u4e8e chain-webpack \u548c TypeScript \u7f16\u5199 Webpack \u914d\u7f6e"),(0,a.kt)("p",null,"\u4e0e CRA \u4e0d\u540c\uff0cUMI \u7684 Webpack \u914d\u7f6e\u3001\u6784\u5efa\u811a\u672c\u90fd\u662f\u7528 TS \u5199\u7684\uff0c\u800c\u4e14\u8fd8\u7528\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"webpack-chain")," \u8fdb\u884c\u914d\u7f6e\u3002\u4e2a\u4eba\u8ba4\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"webpack-chain")," \u7ef4\u62a4\u6027\u786e\u5b9e\u6bd4\u8f83\u597d\uff0c\u9996\u5148 ",(0,a.kt)("inlineCode",{parentName:"p"},"webpack-chain")," \u7528\u4e86\u5efa\u9020\u8005\u6a21\u5f0f\uff0c\u907f\u514d\u4e86 Webpack \u914d\u7f6e\u4e2d\u6df1\u5ea6\u5bf9\u8c61\u5d4c\u5957\u95ee\u9898\uff0c\u540c\u65f6\u7f16\u5199\u6761\u4ef6\u914d\u7f6e\u66f4\u65b9\u4fbf\u3002\u6b64\u5916 UMI \u4f5c\u4e3a\u5e94\u7528\u6846\u67b6\uff0c\u7ecf\u5e38\u9700\u8981\u5916\u90e8\u8986\u76d6 Webpack \u914d\u7f6e\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"webpack-chain")," \u5bf9\u4e8e\u4fee\u6539 loader \u94fe\u3001plugins \u6570\u7ec4\u975e\u5e38\u65b9\u4fbf\uff0c\u4e0d\u9700\u8981\u5404\u79cd\u4e0b\u6807\u8bbf\u95ee\u3001\u5404\u79cd ",(0,a.kt)("inlineCode",{parentName:"p"},"find()"),"\u3002"),(0,a.kt)("p",null,"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"webpack-chain")," \u5b98\u65b9\u4ecd\u7136\u505c\u7559\u5728 Webpack4 \u9636\u6bb5\uff0cUMI \u7528\u7684\u662f fork \u81ea\u5b98\u65b9\u5e93\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"webpack-5-chain"),"\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("a",{parentName:"p",href:"https://github.com/sorrycc/webpack-chain"},"https://github.com/sorrycc/webpack-chain"))),(0,a.kt)("p",null,"\u5982\u679c\u60f3\u7528 TypeScript \u7f16\u5199 Webpack \u914d\u7f6e\uff0c\u6709\u4e24\u79cd\u65b9\u6848\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u7b2c\u4e00\u79cd\u76f4\u63a5\u7528 ",(0,a.kt)("inlineCode",{parentName:"li"},"ts-node"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"esno")," \u7b49 TypeScript \u8fd0\u884c\u65f6\u542f\u52a8 Webpack \u7f16\u8bd1\uff08\u9002\u5408\u4e1a\u52a1\u5de5\u7a0b\uff09"),(0,a.kt)("li",{parentName:"ul"},"\u53e6\u4e00\u79cd\u662f\u5c06 TS \u6587\u4ef6\u9884\u7f16\u8bd1\u4e3a JS \u518d\u7528 node \u8fd0\u884c\uff08\u9002\u5408\u7b2c\u4e09\u65b9\u5e93\uff09")),(0,a.kt)("p",null,"\u8fd9\u91cc\u7528\u7684\u662f\u7b2c\u4e8c\u79cd\u65b9\u6848\uff0c\u53d1\u5305\u524d\u7528 rollup \u8f6c\u8bd1\u4e00\u4e0b\uff0c\u5e73\u884c\u8f93\u51fa\uff0c\u4fdd\u7559\u6e90\u76ee\u5f55\u7ed3\u6784\u3002\u9996\u5148\u5de5\u7a0b\u6574\u4f53\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"root\n|- bin\n|  |- cli.js\uff08\u6b64\u6587\u4ef6\u5185\u5bb9\u56fa\u5b9a\uff0c\u76f4\u63a5 NPM \u53d1\u5305\uff09\n|- src\n|  |- config\n|  |  |- webpack.config.ts\n|  |- cli.ts\n|- package.json\n|- rollup.config.js\n")),(0,a.kt)("p",null,"Rollup \u6253\u5305\u914d\u7f6e\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="rollup.config.js"',title:'"rollup.config.js"'},'const resolve = require("@rollup/plugin-node-resolve");\nconst externals = require("rollup-plugin-node-externals");\nconst typescript = require("@rollup/plugin-typescript");\n\nmodule.exports = {\n  input: \'src/cli.ts\',\n  output: [\n    {\n      dir: "dist",\n      format: "cjs",\n      preserveModules: true,\n      preserveModulesRoot: \'src\',\n    }\n  ],\n  plugins: [\n    resolve(),\n    externals({\n      devDeps: false,\n    }),\n    typescript(),\n  ]\n}\n')),(0,a.kt)("p",null,"Webpack \u914d\u7f6e\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'import fs from "node:fs";\nimport path from "node:path";\n// @ts-ignore\nimport resolve from "resolve";\nimport webpack from "webpack";\nimport Config from "webpack-5-chain";\nimport HtmlWebpackPlugin from "html-webpack-plugin";\n// @ts-ignore\nimport CaseSensitivePathsPlugin from "case-sensitive-paths-webpack-plugin";\nimport TerserPlugin from "terser-webpack-plugin";\nimport MiniCssExtractPlugin from "mini-css-extract-plugin";\nimport CssMinimizerPlugin from "css-minimizer-webpack-plugin";\nimport ForkTsCheckerWebpackPlugin from "fork-ts-checker-webpack-plugin";\nimport ReactRefreshWebpackPlugin from "@pmmmwh/react-refresh-webpack-plugin";\nimport Webpackbar from "webpackbar";\n// @ts-ignore\nimport BundleAnalyzerPlugin from "webpack-bundle-analyzer/lib/BundleAnalyzerPlugin";\n\nconst appPath = process.cwd();\nconst appBuild = path.resolve(appPath, "dist");\nconst appHtml = path.resolve(appPath, "public/index.html");\nconst appSrc = path.resolve(appPath, "src");\nconst appTsConfig = path.resolve(appPath, "tsconfig.json");\nconst appNodeModules = path.resolve(appPath, "node_modules");\nconst appWebpackCache = path.resolve(appPath, "node_modules/.cache");\nconst appTsBuildInfoFile = path.resolve(\n  appPath,\n  "node_modules/.cache/tsconfig.tsbuildinfo"\n);\n\nconst isEnvDevelopment = process.env.NODE_ENV === "development";\nconst isEnvProduction = process.env.NODE_ENV === "production";\nconst useBundleAnalyzer = process.env.ANALYZE === "true";\nconst useTypeScript = fs.existsSync(appTsConfig);\n\nconst config = new Config();\n\n// mode\nconfig.mode(isEnvDevelopment ? "development" : "production");\nconfig.stats("errors-warnings");\nconfig.infrastructureLogging({ level: "error" });\n\n// entry\nconfig.entry("main").add(appSrc);\n\n// devtool\nconfig.devtool(isEnvDevelopment ? "eval-cheap-module-source-map" : false);\n\n// output\nconfig.output\n  .path(appBuild)\n  .filename(\n    isEnvProduction\n      ? "static/js/[name].[contenthash:8].js"\n      : "static/js/[name].js"\n  )\n  .chunkFilename(\n    isEnvProduction\n      ? "static/js/[name].[contenthash:8].chunk.js"\n      : "static/js/[name].chunk.js"\n  )\n  // .assetModuleFilenamet("static/media/[name].[hash][ext]")\n  .publicPath("auto")\n  .set("assetModuleFilename", "static/media/[name].[hash][ext]")\n  .set("hashFunction", "xxhash64")\n  .clean(true);\n\n// resolve\n// prettier-ignore\nconfig.resolve\n  .modules\n    .add("node_modules")\n    .end()\n  .alias\n    .merge({\n      "@": appSrc,\n    })\n    .end()\n  .extensions\n    .merge([".ts", ".tsx", ".js", ".jsx", ".json", ".wasm"])\n    .end();\n\n// rules\n// prettier-ignore\nconfig.module\n  .rule("js")\n    .test(/\\.(js|mjs|jsx|ts|tsx)$/)\n      .include.add([appSrc])\n      .end()\n    .use("babel-loader")\n      .loader(require.resolve("babel-loader"))\n      .options({\n        plugins: [\n          // \u5f00\u53d1\u73af\u5883\u542f\u7528 `react-refresh` \u70ed\u66f4\u65b0 React \u7ec4\u4ef6\n          isEnvDevelopment && require.resolve("react-refresh/babel"),\n        ].filter(Boolean),\n        // \u542f\u7528 babel-loader \u7f13\u5b58\u80fd\u529b\n        // Webpack5 \u81ea\u5e26\u7684\u6301\u4e45\u5316\u7f13\u5b58\u7c92\u5ea6\u592a\u5927\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u5c31\u4f1a\u5bfc\u81f4\u7f13\u5b58\u5931\u6548\n        cacheDirectory: true,\n        cacheCompression: false,\n        compact: isEnvProduction,\n      })\n      .end()\n    .end()\n\n  .rule("css")\n    .test( /\\.(css|less)$/i)\n    .sideEffects(true)\n    .use("style-loader")\n      .loader(\n        isEnvDevelopment\n          ? require.resolve("style-loader")\n          : MiniCssExtractPlugin.loader\n      )\n      .end()\n    .use("css-loader")\n      .loader(require.resolve("css-loader"))\n      .options({\n        sourceMap: isEnvDevelopment,\n        importLoaders: 2,\n        localIdentName: \'[local]___[hash:base64:5]\',\n      })\n      .end()\n    .use("postcss-loader")\n      .loader(require.resolve("postcss-loader"))\n      .options({\n        postcssOptions: {\n          // Necessary for external CSS imports to work\n          // https://github.com/facebook/create-react-app/issues/2677\n          ident: \'postcss\',\n          config: false,\n          plugins: [\n            \'postcss-flexbugs-fixes\',\n            [\n              \'postcss-preset-env\',\n              {\n                autoprefixer: {\n                  flexbox: \'no-2009\',\n                },\n                stage: 3,\n              },\n            ],\n            // \u4e0d\u9700\u8981 postcss \u63d0\u4f9b\u7684 CSS Reset \u9009\u9879\n            // \u4e00\u822c\u7ec4\u4ef6\u5e93\u4f8b\u5982 Antd \u90fd\u4f1a\u5185\u7f6e CSS Reset\n            // \'postcss-normalize\',\n          ],\n        },\n        sourceMap: isEnvDevelopment,\n      })\n      .end()\n    .use("less-loader")\n      .loader(require.resolve("less-loader"))\n      .options({\n        lessOptions: {\n          javascriptEnabled: true,\n          modifyVars: {},\n        },\n      })\n      .end()\n    .end()\n\n  .rule("svg")\n    .test(/\\.svg$/)\n    .issuer({\n      and: [/\\.(ts|tsx|js|jsx|md|mdx)$/],\n    })\n    .use("@svgr/webpack")\n      .loader(require.resolve("@svgr/webpack"))\n      .options({\n        prettier: false,\n        svgo: false,\n        svgoConfig: {\n          plugins: [{ removeViewBox: false }],\n        },\n        titleProp: true,\n        ref: true,\n      })\n      .end()\n    .use("file-loader")\n      .loader(require.resolve("file-loader"))\n      .options({\n        name: \'static/media/[name].[hash].[ext]\',\n      })\n      .end()\n    .end()\n\n  .rule("font")\n    .test(/\\.(woff|woff2|ttf|eot|svg)$/)\n    .exclude\n      .add(/node_modules/)\n      .end()\n    .type(\'asset\')\n    .end()\n\n  .rule("image")\n    .test(/\\.(png|jpg|gif|jpeg|ico|cur)$/)\n    .exclude\n      .add(/node_modules/)\n      .end()\n    .type(\'asset\')\n    .end();\n\n// cache\nconfig.cache({\n  type: \'filesystem\',\n  cacheDirectory: appWebpackCache,\n  store: \'pack\',\n  buildDependencies: {\n    defaultWebpack: [\'webpack/lib/\'],\n    config: [__filename],\n    tsconfig: useTypeScript ? [appTsConfig] : [],\n  },\n});\n\n// devServer\nconfig.devServer\n  .set("static", appBuild)\n  .compress(true)\n  .hot(true)\n  .open(true)\n  .historyApiFallback(true)\n  .host("0.0.0.0")\n  .port(8066);\n\n// plugins\nconfig\n  .plugin("webpackbar")\n    .use(Webpackbar)\n    .end()\n  .plugin("html")\n    .use(HtmlWebpackPlugin, [\n      {\n        template: appHtml,\n        title: "React App",\n        filename: "index.html",\n        ...(isEnvProduction && {\n          minify: {\n            removeComments: true,\n            collapseWhitespace: true,\n            removeRedundantAttributes: true,\n            useShortDoctype: true,\n            removeEmptyAttributes: true,\n            removeStyleLinkTypeAttributes: true,\n            keepClosingSlash: true,\n            minifyJS: true,\n            minifyCSS: true,\n            minifyURLs: true,\n          },\n        }),\n      }\n    ])\n    .end()\n  .plugin("define")\n    .use(webpack.DefinePlugin, [\n      {\n        \'process.env.NODE_ENV\': isEnvDevelopment ? \'"development"\' : \'"production"\',\n        __DEV__: isEnvDevelopment,\n      }\n    ])\n    .end();\n\nif (isEnvDevelopment) {\n  config\n    .plugin("react-refresh-webpack-plugin")\n      .use(ReactRefreshWebpackPlugin, [{\n        overlay: false,\n      }])\n      .end()\n    .plugin("case-sensitive-paths-webpack-plugin")\n      .use(CaseSensitivePathsPlugin)\n      .end();\n}\n\nif (isEnvProduction) {\n  config\n    .plugin("mini-css-extract-plugin")\n      .use(MiniCssExtractPlugin, [\n        {\n          filename: \'static/css/[name].[contenthash:8].css\',\n          chunkFilename: \'static/css/[name].[contenthash:8].chunk.css\',\n          // \u89e3\u51b3\u7528\u4e86 antd \u7ec4\u4ef6\u5e93\u4e4b\u540e\uff0c\u62bd\u63d0\u6837\u5f0f\u51b2\u7a81\u95ee\u9898\n          ignoreOrder: true,\n        }\n      ])\n      .end();\n}\n\nif (useTypeScript) {\n  config\n    .plugin("fork-ts-checker-webpack-plugin")\n      .use(ForkTsCheckerWebpackPlugin, [\n        {\n          async: isEnvDevelopment,\n          typescript: {\n            typescriptPath: resolve.sync(\'typescript\', {\n              basedir: appNodeModules,\n            }),\n            configOverwrite: {\n              compilerOptions: {\n                sourceMap: isEnvDevelopment,\n                skipLibCheck: true,\n                inlineSourceMap: false,\n                declarationMap: false,\n                noEmit: true,\n                incremental: true,\n                tsBuildInfoFile: appTsBuildInfoFile,\n              },\n            },\n            context: appPath,\n            diagnosticOptions: {\n              syntactic: true,\n            },\n            mode: \'write-references\',\n            // profile: true,\n          },\n          issue: {\n            // This one is specifically to match during CI tests,\n            // as micromatch doesn\'t match\n            // \'../cra-template-typescript/template/src/App.tsx\'\n            // otherwise.\n            include: [\n              { file: \'../**/src/**/*.{ts,tsx}\' },\n              { file: \'**/src/**/*.{ts,tsx}\' },\n            ],\n            exclude: [\n              { file: \'**/src/**/__tests__/**\' },\n              { file: \'**/src/**/?(*.){spec|test}.*\' },\n              { file: \'**/src/setupProxy.*\' },\n              { file: \'**/src/setupTests.*\' },\n            ],\n          },\n          logger: {\n            infrastructure: \'silent\',\n          },\n        }\n      ])\n      .end();\n}\n\nif (useBundleAnalyzer) {\n  config\n    .plugin("analyze")\n      .use(BundleAnalyzerPlugin)\n      .end();\n}\n\n// optimization\nconfig.optimization\n  .minimize(isEnvProduction)\n  .minimizer("terser")\n    .use(TerserPlugin, [\n      {\n        minify: TerserPlugin.terserMinify,\n        extractComments: false,\n        terserOptions: {\n          parse: {\n            ecma: 8,\n          },\n          compress: {\n            ecma: 5,\n            warnings: false,\n            comparisons: false,\n            inline: 2,\n            // \u751f\u4ea7\u73af\u5883\u6253\u5305\u79fb\u9664 console\n            drop_console: true,\n          },\n          mangle: {\n            safari10: true,\n          },\n          output: {\n            ecma: 5,\n            comments: false,\n            ascii_only: true,\n          },\n        },\n      } as any\n    ])\n    .end()\n  .minimizer("css-minimizer")\n    .use(CssMinimizerPlugin)\n    .end()\n  .runtimeChunk("single")\n  .splitChunks({\n    chunks: "all",\n    cacheGroups: {\n      // \u9488\u5bf9\u4e1a\u52a1\u7ec4\u4ef6\u5e93\u7684\u7f13\u5b58\u7ec4\n      // commons: {\n      //   test: /[\\\\/]node_modules[\\\\/]@study[\\\\/]/,\n      //   name: \'commons\',\n      //   chunks: \'all\',\n      // },\n      // \u9488\u5bf9 antd \u7684\u7f13\u5b58\u7ec4\n      // vendor: {\n      //   test: /[\\\\/]node_modules[\\\\/](antd|@ant-design|rc-.*?)[\\\\/]/,\n      //   name: \'vendor\',\n      //   chunks: \'all\',\n      //   enforce: true,\n      // },\n      // Extracting all CSS/less in a single file\n      // styles: {\n      //   name: \'styles\',\n      //   test: /\\.(c|le)ss$/,\n      //   chunks: \'all\',\n      //   enforce: true,\n      // },\n    }\n  });\n\ntype IOpts = {\n  chainWebpack?: (config: Config) => void;\n  modifyWebpackConfig?: webpack.Configuration;\n}\n\nexport async function getConfig({ chainWebpack, modifyWebpackConfig }: IOpts) {\n  if (chainWebpack) {\n    chainWebpack(config);\n  }\n\n  if (modifyWebpackConfig) {\n    config.merge(modifyWebpackConfig);\n  }\n\n  return config.toConfig();\n}\n')))}d.isMDXComponent=!0}}]);